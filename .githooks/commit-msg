#!/usr/bin/env sh

set -eu

MSG_FILE="$1"
HEADER="$(head -n1 "$MSG_FILE" | tr -d '\r')"

# Allow merge and revert commits generated by git.
case "$HEADER" in
  "Merge "*|"Revert "*)
    exit 0
    ;;
esac

PATTERN='^(feat|fix|docs|refactor|test|ci|chore)(\([a-z0-9._/-]+\))?!?: .+'

if printf '%s' "$HEADER" | grep -Eq "$PATTERN"; then
  exit 0
fi

echo "Invalid commit message format." >&2
echo "Expected: <type>(optional-scope): <summary>" >&2
echo "Allowed types: feat, fix, docs, refactor, test, ci, chore" >&2
echo "Example: fix(remote): block non-fast-forward pull" >&2
exit 1
